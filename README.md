# users-api

[Cхема решения](https://viewer.diagrams.net/?tags=%7B%7D&lightbox=1&highlight=0000ff&edit=_blank&layers=1&nav=1&title=%D1%81%D1%85%D0%B5%D0%BC%D0%B0.drawio#R%3Cmxfile%3E%3Cdiagram%20name%3D%22Page-1%22%20id%3D%22-H_mtQnk-PTXWXPvYvuk%22%3E7V1bl6I4EP41PjrHhPtjT19mz9np3TnbM2em96UPLWllhzYORFvn12%2FQoICgKEIFO09CJcGCj9RXVIqip12%2FLj6F7nR8Tz0S9PDAW%2FS0mx7GCDk6%2F4kly7XEtIRgFPqe6LQVPPi%2FiRAOhHTmeyTKdGSUBsyfZoVDOpmQIcvI3DCkb9luLzTI%2FuvUHZEdwcPQDXal332PjZPzMp1twx%2FEH43FX9vYWje8uklncSbR2PXoW0qk3fa065BStt56XVyTIL54yXVZj7srad0oFpIJqzKAftPvfrloNo90tPwzsP794oR9ZAvl2DI5Y%2BLxCyB2acjGdEQnbnC7lX4M6WzikfiwA7637fOZ0ikXIi78jzC2FGi6M0a5aMxeA9FKFj77IYbH24%2Fx9gdD7N0sUk03y2RnwsLlj%2FROalS8ux222kvGrc8vPqnS6yZEEZ2FQ7LnYok7l7nhiLA9%2FfAGXT4tCH0lXB8%2BLiSBy%2Fx5Vg9X3J%2BjTb8thHxDoHgEotgERXSD4mOq5RCiWxAfMxhKg6gBiqjVFUQBkLEgkRFKzt1gJv6ph82Aq%2FvxhfITTkNm%2FprRpKEfrS76Fe%2BA9OlideGSdr41in85W4Qe6qPkgFy%2F9THXzYnY8%2Bd50XOYl%2FCxBf0KRInWCQsnSmm7%2Bu39tyJNlRJKiZOVOHxP5wzk1vzFFutt7DPyMHVXFueNO6pZUydmMQkZWew3XLuGRgzQEi8vcXM1sf%2BWchoHQjZO%2BYvIGDRknJDRFdpo1xH4fYW1e%2Fr1W%2FT1Tn9yELPn%2Fre%2BVpFuSu6CdugmuVVgEEW9U5x16RHVbVBIQb31C4XUAH0AM0Dd9UuFVIeE1AY1vIMPOM2lg2qYogyiDYVJamFqtWV592lZ59nNLnl2m0UkjPru1C91f%2Bt7qwXA7Diwpd6qbme9VW1Q4K3iAm%2FVbMxZhY1anWI0W5lg5U6o7HFI5HTw8cOCCkRWhRSUBjEwDcr6RFkLUacmoquhV2HoLlMdptSfsCh15C%2BxYEsAhmFkCMCwc2tHuf6mM9jXn2%2BsNdjeW5tTqWFBmmPoVzoZ0eiJ35uMhA2ydK2YUp6ldauApY02WRo3h8iQTl780UM4lxWNzVXdh0arPtMZPNiy1Yf7eH7clIdvc1hEY3cabw6Xgc9BCbXDiDyv4fv8vBG4w5%2BjFah%2Fzxg%2FDBFyEXhGxnlg1LRcoNbehdEuQNFubE6BrsCfFi44zvONOAeyqzgXI75FAjeK%2FGEivvOD7Bw9C%2FcaFbkXdPHQaG76isVDXDp%2F1eKhUuLdKCH94iHOcZKtgy8eWo0bJ00ZJ6WEUkJ646Rj6YyTrkO6zB2LQzkVfWGtbiCqHqSdSVYBgEYHzTpxGnYFsEpyVEooJTrgCph6LnYGn%2BSoqejZ2aNnWjd4SWuamE4KoHXEksitv1JCKiWkJyZDvgCafobV6%2FNH0DpyO8mtv1JCKiWkt06WfBE0U0XQjngV1a7oDxugr5IkahYwzp6pezIJhcTzo6dDoRtFCkoJRQoFpGDnYil6QR5S2y5rgw%2FU%2F8TWohTcHBYdSiezc1mBRkFIzGwznczszEKKBMy%2BflGwArObg%2BK7oKVMMQzA7IdiX4rZlRKK2Qsowcmn7cMzu9FgqvilMjuHSDZq70xlr3NSdNVCUCYGpejyUlDNUfShAHAbFK2GXgZrIYTlo60GX5G4WNpCumS0ZUDEJfV35vPKrb9SojM8kI9LmkWvubZMAyouWTsuuVmDBHt4GQCwgCGBAVZDL8Mw5sM6EhhGs8Eco0s1jDthHXjLCBHdNyWwjFI4ZEoJqZSQngZ24iQy8IAK79ePk4DzgNWZ8H5q5R5DLd2bokLB4XUB0KQ8qzPf7pAgHaMI0%2FLarVCQ2hoopClAO1CqtPI0tTEkpuYZ6p2UVbZzp35%2F5DLyFldorMajrWeoO06GC1FBhrpmFZBhY7Xtkj%2FrlN2EI8OqGeqgL2xaSB5MKxZR7wKmsB%2BwsLACtQFQYT9hYcG6OBcLqg7qt8Ka31P81jyoSEJQW%2FuKxV41u%2FoZi3q1fHMhHPjPWFiwb18cNce8pKjIhMZBtlgi6onE7Z4bjTdQnnFeVa4tAsp%2FDc6qIZ1Es0DWKYVzq5xFT4JIa3NK2RK9qlzZF4FyRWzcCdZK1GxufvV%2FzmWdYoYp3RSDWXmQYLpULRRvglaKt0E%2FpXRMkTMIbGxYU1aeox5N3UktU%2Fb9lm8OrgOfrMxXYs3Wx5XEmjkoFzquaMwaWwy3G%2FTdrm%2F%2BqsoqXFN%2FGsUTcbMoHtCZ1womKF9QvqhOY9FzUWNr28nno9S3ao6qt2nkUk2gv1XjNJhweLkw4lyYwnagYTyD%2B%2F3%2BYNTzRQbBYVQfADvl8Uu62Vj%2B6rCCsTxlob3ZyHdDGl%2FWTdsnfhnG99QjcY%2F%2FAQ%3D%3D%3C%2Fdiagram%3E%3C%2Fmxfile%3E)

## Как настроить

Создаем файл `.env` и заполняем его значениями из `.env.example`.

```shell script
cp ./sharding-repl-cache/.env-example ./sharding-repl-cache/.env
```


Запускаем mongodb и приложение

```shell
docker compose -f ./sharding-repl-cache/compose.yaml up --build -d
```

Настраиваем сервер конфигурации mongodb

```shell
./sharding-repl-cache/scripts/mongo-init-cfg.sh
```

Настраиваем шарды и заполняем их данными

```shell
./sharding-repl-cache/scripts/mongo-init.sh
```

Проверяем шардирование

```shell
./sharding-repl-cache/scripts/mongo-check.sh
```
После выполнения скрипта данные должны распределится по шардам в соотношение 508 и 492 записи

Настраиваем кэширование

```shell
./sharding-repl-cache/scripts/redis-init.sh
```

Останавливаем 

```shell
docker compose -f ./sharding-repl-cache/compose.yaml stop
```

## Как запустить и проверить кэширование
Выполняем команду

```shell
docker compose -f ./sharding-repl-cache/compose.yaml up -d
```

Проверяем время отклика через запрос сриска пользователей

http://localhost:8080/docs#/default/list_users__collection_name__users_get

Второй и все последующие запросы должны проходить значительно быстрее первого

Останавливаем 

```shell
docker compose -f ./sharding-repl-cache/compose.yaml stop
```